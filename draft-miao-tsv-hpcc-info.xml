<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY rfc2119 SYSTEM "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY rfc8174 SYSTEM "http://xml2rfc.tools.ietf.org/public/rfc/bibxml/reference.RFC.8174.xml">
<!ENTITY INT "inband telemetry">
<!ENTITY I-D.ietf-avtcore-cc-feedback-message SYSTEM "http://xml2rfc.tools.ietf.org/public/rfc/bibxml3/reference.I-D.ietf-avtcore-cc-feedback-message.xml">
]>
<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<?rfc toc="yes" ?>
<?rfc compact="yes" ?>
<?rfc symrefs="yes" ?>
<rfc category="info" 
     docName="draft-miao-tsv-hpcc-info"
     ipr="trust200902">
  <!-- What is the category field value-->

  <front>
    <title abbrev="HPCC++">
    HPCC++: Enhanced High Precision Congestion Control
    </title>
    
    
    <author fullname="Rui Miao" initials="R." surname="Miao">
      <organization>Alibaba Group</organization>

      <address>
        <postal>
          <street>525 Almanor Ave, 4th Floor</street>
          <city>Sunnyvale</city>
          <region>CA</region>
          <code>94085</code>
          <country>USA</country>
        </postal>
	      <email>miao.rui@alibaba-inc.com</email>
      </address>
    </author>


    <!-- <author fullname="Hongqiang H. Liu" initials="H" surname="Liu">
      <organization>Alibaba Group</organization>

      <address>
        <postal>
          <street>108th Ave NE, Suite 800</street>
          <city>Bellevue</city>
          <region>WA</region>
          <code>98004</code>
          <country>USA</country>
        </postal>
        <email>hongqiang.liu@alibaba-inc.com</email>
      </address>
    </author> -->


    <author fullname="Surendra Anubolu" initials="S" surname="Anubolu">
      <organization abbrev="Broadcom Inc">Broadcom, Inc.</organization>
      <address>
        <postal>
          <street>1320 Ridder Park</street>
          <city>San Jose</city>
          <region>CA</region>
          <code>95131</code>
          <country>USA</country>
        </postal>
        <email>surendra.anubolu@broadcom.com</email>
      </address>
    </author>

    <author fullname="Rong Pan" initials="R" surname="Pan">
      <organization abbrev="Intel Corporation">Intel, Corp.</organization>
      <address>
        <postal>	
          <street>2200 Mission College Blvd.</street>
          <city>Santa Clara</city>
          <region>CA</region>
          <code>95054</code>
          <country>USA</country>
        </postal>
	<email>rong.pan@intel.com</email>
      </address>
    </author>


    <author fullname="Jeongkeun Lee" initials="J" surname="Lee">
      <organization abbrev="Intel Corporation">Intel, Corp.</organization>

      <address>
        <postal>
          <street>101 Innovation Dr</street>
          <city>San Jose</city>
          <region>CA</region>
          <code>95134</code>
          <country>USA</country>
        </postal>
        <email>jk.lee@intel.com</email>
      </address>
    </author>

    <author fullname="Barak Gafni" initials="B. " surname="Gafni">
      <organization>NVIDIA</organization>
      <address>
        <postal>
          <street>350 Oakmead Parkway, Suite 100</street>
          <city>Sunnyvale</city>
          <region>CA</region>
          <code>94085</code>
          <country>USA</country>
        </postal>

        <email>gbarak@nvidia.com</email>
      </address>
    </author>

    <author fullname="Yuval Shpigelman" initials="Y. " surname="Shpigelman">
      <organization>NVIDIA</organization>
      <address>
        <postal>
          <street>Haim Hazaz 3A</street>
          <city>Netanya</city>
          <region></region>
          <code>4247417</code>
          <country>Israel</country>
        </postal>

        <email>yuvals@nvidia.com</email>
      </address>
    </author>
    <author fullname="Jeff Tantsura" initials="J. " surname="Tantsura">
      <organization>Microsoft Corporation</organization>
      <address>
        <postal>
          <street>One Microsoft Way</street>
          <city>Redmond</city>
          <region>Washington</region>
          <code>98052-6399</code>
          <country>USA</country>
        </postal>
        <email>jefftantsura@microsoft.com</email>
      </address>
    </author>
    
    <date year="2022" />

    <area>TSV</area>

    <keyword>Data Center Networking</keyword>

    <keyword>Congestion Control</keyword>

    <abstract>
    <t>Congestion control (CC) is the key to achieving ultra-low latency,
high bandwidth and network stability in high-speed networks. 
However, the existing high-speed CC schemes have inherent limitations for reaching these goals.</t>

    <t>In this document, we describe
HPCC++ (High Precision Congestion Control), a new high-speed CC
mechanism which achieves the three goals simultaneously. HPCC++
leverages inband telemetry to obtain precise link load
information and controls traffic precisely. By addressing challenges
such as delayed signaling during congestion and overreaction to the congestion signaling using inband and granular telemetry, HPCC++ can quickly 
converge to utilize all the available bandwidth while avoiding congestion, and can maintain near-zero
in-network queues for ultra-low latency. HPCC++ is also fair and
easy to deploy in hardware, implementable with commodity NICs and switches.</t>
   </abstract>
   
   </front>

    <middle>
    <section anchor="sec-intro" title="Introduction">

    <t>The link speed in data center networks has grown from 1Gbps to
      100Gbps in the past decade, and this growth is continuing. Ultralow 
      latency and high bandwidth, which are demanded by more
      and more applications, are two critical requirements in today's and
      future high-speed networks. </t>

    <t>Given that traditional software-based network stacks in hosts
      can no longer sustain the critical latency and bandwidth requirements as described in <xref target="Zhu-SIGCOMM2015"> </xref>, 
      offloading network stacks into hardware is an inevitable
      direction in high-speed networks. 
      As an example, large-scale networks with RDMA (remote direct memory access)
      often uses hardware-offloading solutions.
      In some cases, the RDMA networks still face fundamental challenges
      to reconcile low latency, high bandwidth utilization, and high stability.</t>

    <t>This document describes a new congestion control mechanism, HPCC++ (Enhanced High Precision Congestion Control), 
      for large-scale, high-speed networks. The key idea behind HPCC++ is to leverage the precise link load 
      information from signaled through &INT; to compute accurate flow rate updates. Unlike
      existing approaches that often require a large number of iterations
      to find the proper flow rates, HPCC++ requires only one rate update
      step in most cases. Using precise information from &INT; enables
      HPCC++ to address the limitations in current congestion control schemes. First,
      HPCC++ senders can quickly ramp up flow rates for high utilization
      and ramp down flow rates for congestion avoidance. Second, HPCC++
      senders can quickly adjust the flow rates to keep each link's output rate slightly lower than 
      the link's capacity, preventing queues from being built-up as well as preserving 
      high link utilization. Finally, since sending rates are computed precisely based on direct
      measurements at switches, HPCC++ requires merely three independent
      parameters that are used to tune fairness and efficiency. </t>

      <t>HPCC++ is an enhanced version of <xref target="SIGCOMM-HPCC"></xref>. 
      HPCC++ takes into account system constraints and aims to reduce the design 
      overhead and further improves the performance. </t>
      
      <t>This document describes the architecture changes in switches 
      and end-hosts to support the needed tranmission of inband telemetry and its consumption, 
      that imporves the efficiency in handling network congestion. </t>

    </section>

<section anchor = "sec-implementation-telemery"
	 title ="Inband telemetry padding at the network switches">
   <t>HPCC++ only relies on packets to share information across senders,
   receivers, and switches. 
   The switch should capture &INT; information that includes link load (txBytes, qlen, ts) and 
    link spec (switch_ID, port_ID, B) at the egress port.
    Note, each switch should record all those information at the single snapshot to achieve a precise link load
    estimate. Inside a data center, the path length is often no more than 5 hops. 
   The overhead of the inband telemetry padding for HPCC++ is considered to be low.</t>


  <t> As long the above algorithm is met, HPCC++ is open to a variety of inband telemetry format standards, 
  which are orthogonal to the HPCC++ algorithm. 
  Although this document does not mandate a particular &INT; header format or encapsulation, 
  we provide concrete implementation specifications using strandard inband telemetry protocols, 
  including IFA <xref target="I-D.ietf-kumar-ippm-ifa"></xref>, IETF IOAM <xref target="[RFC9179]"></xref>,
  and P4.org INT <xref target="P4-INT"></xref>. 
  In fact, the emerging inband telemetry protocols inform the evolution for a broader range of protocols and network functions, 
  where this document leverages the trend to propose the architecture change to support in-network functions like congestion control with high efficiency.
  </t>


  <section anchor = "sec-implementation-ifa"
	 title ="Inband telemetry on IFA2.0">
   <t>For more details, please refer to IFA <xref target="I-D.ietf-kumar-ippm-ifa"></xref></t>
   
    <t><figure anchor="fig-ifa-header"
               title="Example IFA header">
      <artwork><![CDATA[

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  lns  |  deviceID                             |     rsvd      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Speed |     rsvd      |          rxTimestampSec               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       egressPort              |         ingressPort           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        rxTimeStampNs                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         residenceTime                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                            txBytes                            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       rsvd                    |      Queue Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                             rsvd                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

  ]]></artwork>
	    </figure></t>
  <t><xref target="fig-ifa-header"></xref> shows the packet format of the
	  INT metadata after UDP and IFA metadata header. 
	  The field lns is the local name space and defines the format of the metadata. The field deviceID is a 20-bit field that uniquely identifies the device in the network. 
	  The Speed field is an encode field with the following encoding for port speed:
	  0 - 10G, 1 - 25G, 2 - 40G, 3- 50G, 4 - 100G, 5 - 200G, 6 - 400G.
	  The field cn is the congestion field and denotes if the packet experienced congestion.

  </t>
   </section>


  <section anchor = "sec-implementation-ioam"
	 title ="Inband telemetry on IOAM">
   <t>IOAM is the technology adopted by IETF to be used for in-situ telemetry. For the use of HPCC we would discuss the IOAM trace option as part of the IOAM architecture. IOAM trace supports both 
	   Pre-allocated and Incremental trace Options, meaning that a node in the network may either write data into an already-allocated space in the packet, or may it add the data as an extenation to the IOAM header, respectively. 
	   An IOAM data header has a modular design, where the data types written by a node are determined based on the IOAM trace header instruction list.
	   For the full description of the IOAM header design please refer to IETF IOAM <xref target="[RFC9179]"></xref></t> specification.
	  In order to fulfill the requirements set by the HPCC architecture we would suggest to use the below trace types:
	  </t>
	  
	  <ul bare="false" empty="false" indent="3" spacing="normal">
          <li>Hop_Lim and node_id Short</li>
		  <li>Ingress_if_id and egress_if_id Short</li>
		  <li>Queue Depth
		  <li>Timestamp Fraction: To be used as egress timestamp rather than an ingress timestamp</li>
		  <li>Transmitted Bytes</li>
        </ul>
	  <t>Note that Transmitted Bytes trace type is defined in <xref target="I-D.draft-gafni-ippm-ioam-additional-data-fields"</xref> as a suggested extension to <xref target="[RFC9179]"></xref>.
	</t>
	<t>When using the above trace types, the IOAM data header would be constructed as follows:
			  
	  <t><figure anchor="fig-ioam-data"
               title="Example of an IOAM data header">
   <artwork><![CDATA[
 
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Hop_Lim     |              node_id                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     ingress_if_id             |         egress_if_id          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       queue depth                             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                   timestamp fraction                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                           tx_bytes                            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


  ]]></artwork>
          </figure></t>
		  
   </section>

  <section anchor = "sec-implementation-p4"
	 title ="Inband telemetry on P4.org INT">

     <t><figure anchor="fig-p4int"
               title="Example P4.org INT v2.1 per-hop metadata header">
   <artwork><![CDATA[

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Node ID (Nth hop)                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Ingress Interface ID     |      Egress Interface ID      | 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Queue ID   |               Queue occupnacy                 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Egress timestamp                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Egress timestamp (cont'd)                  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                 Egress interface Tx utilization               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Node ID (N-1th hop)                    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              ...                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Node ID (1st hop)                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              ...                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


  ]]></artwork>
          </figure></t>

  <t><xref target="fig-p4int"></xref> shows the per-hop metadata format of the
	  P4.org INT-MD mode (following INT v2.1 spec). 
	  Each hop switch along the path adds its Node ID for the sender to be
	  able to track the path and detect a path change event. If so, it throws away
	  the existing status records of the flow and builds up new records.
	  
	  Queue occupancy (24 bits) is the current buffer occupancy of the egress port and queue
	  that the flow is going through. Egress timestamp (8 bytes) is used by HPCC++
	  algorithm to eventually compute interface utilization. Since P4.org INT reports
	  Egress TX utilization in-band, the Egress timestsamp is not mandatory but optional.
	  
	  HPCC++ algorithm today doesn't require Ingress Interface ID. P4.org INT defines Ingress
	  and Egress Interface IDs as one metadata instruction. We keep the Ingress ID for a future use.
</t>


   </section>

   

</section>


<section anchor = "sec-iana"
	 title = "IANA Considerations">

<t>This document makes no request of IANA.</t>

</section>

<section anchor = "sec-acknowledgments"
	 title = "Acknowledgments">

<t>
The authors would like to thank RTGWG members for their valuable review
comments and helpful input to this specification. </t>

</section> 

<section title="Contributors"  
        anchor="sec-contributors">

<t>The following individuals have contributed to the implementation
  and evaluation of the proposed scheme, and therefore have helped
  to validate and substantially improve this specification:
  Pedro Y. Segura, Roberto P. Cebrian, Robert Southworth and Malek Musleh. </t>

</section>

</middle>
  
<back>
    

     <references title="Normative References">
 
     &rfc2119;  <!-- RFCs -->
     &rfc8174;   <!--- Ambiguity of Uppercase vs Lowercase -->
     </references>

    <references title="Informative References">
      &I-D.ietf-avtcore-cc-feedback-message; 
      

<reference anchor="Zhu-SIGCOMM2015"
		 target="">
        <front>
          <title>
	    Congestion Control for Large-Scale RDMA Deployments
          </title>

          <author fullname="Yibo Zhu" initials="Y." surname="Zhu">
            <organization></organization>
          </author>

          <author fullname="Haggai Eran" initials="H." surname="Eran">
            <organization></organization>
          </author>

          <author fullname="Daniel Firestone" initials="D." surname="Firestone">
            <organization></organization>
          </author>

          <author fullname="Chuanxiong Guo" initials="C." surname="Guo">
            <organization></organization>
          </author>

          <author fullname="Marina Lipshteyn" initials="M." surname="Lipshteyn">
            <organization></organization>
          </author>

          <author fullname="Yehonatan Liron" initials="Y." surname="Liron">
            <organization></organization>
          </author>

          <author fullname="Jitendra Padhye" initials="J." surname="Padhye">
            <organization></organization>
          </author>

          <author fullname="Shachar Raindel" initials="S." surname="Raindel">
            <organization></organization>
          </author>

          <author fullname="Mohammad Haj Yahia" initials="M. H." surname="Yahia">
            <organization></organization>
          </author>

          <author fullname="Ming Zhang" initials="M." surname="Zhang">
            <organization></organization>
          </author>

          <date month="August" year="2015" />
        </front>

        <seriesInfo name="ACM SIGCOMM"
		    value = "London, United Kingdom"/>

      </reference>
      
      <reference anchor="P4-INT"
		 target="https://github.com/p4lang/p4-applications/blob/master/docs/INT_v2_0.pdf">
        <front>
          <title>
	    In-band Network Telemetry (INT) Dataplane Specification, v2.0
          </title>

          <author >
            <organization></organization>
          </author>
          <date month="February" year="2020" />
        </front>
      </reference>

      <reference anchor="[RFC9179]"
		 target="https://datatracker.ietf.org/doc/html/rfc9197">
        <front>
          <title>
	    Data Fields for In Situ Operations, Administration, and Maintenance (IOAM)
          </title>

          <author >
            <organization></organization>
          </author>
          <date month="May" year="2022" />
        </front>
      </reference>

	    <reference anchor="I-D.draft-gafni-ippm-ioam-additional-data-fields"
		 target="https://datatracker.ietf.org/doc/html/draft-gafni-ippm-ioam-additional-data-fields-00">
        <front>
          <title>
	    Additional data fields for IOAM Trace Option Types
          </title>

          <author >
            <organization></organization>
          </author>
          <date month="May" year="2021" />
        </front>
      </reference>

      <reference anchor="I-D.ietf-kumar-ippm-ifa"
		 target="https://tools.ietf.org/html/draft-kumar-ippm-ifa-01">
        <front>
          <title>
	    Inband Flow Analyzer
          </title>

          <author >
            <organization></organization>
          </author>
          <date month="February" year="2019" />
        </front>
      </reference>

      <reference anchor="draft-miao-tsv-hpcc"
		 target="">
        <front>
          <title>HPCC++: Enhanced High Precision Congestion Control
          </title>

                    <author fullname="Rui Miao" initials="R." surname="Miao">
            <organization></organization>
          </author>
          <date month="June" year="2022" />
        </front>

      </reference>

            <reference anchor="draft-miao-tsv-hpcc-info"
		 target="">
        <front>
          <title>HPCC++: Enhanced High Precision Congestion Control (Informational)
          </title>
           <author fullname="Rui Miao" initials="R." surname="Miao">
            <organization></organization>
          </author>
          <date month="June" year="2022" />
        </front>

      </reference>


      <reference anchor="SIGCOMM-HPCC"
		 target="">
        <front>
          <title>
	    HPCC: High Precision Congestion Control
          </title>

          <author fullname="Yuliang Li" initials="Y." surname="Li">
            <organization></organization>
          </author>

          <author fullname="Rui Miao" initials="R." surname="Miao">
            <organization></organization>
          </author>

          <author fullname="Hongqiang Harry Liu" initials="H." surname="Liu">
            <organization></organization>
          </author>

          <author fullname="Yan Zhuang" initials="Y." surname="Zhuang">
            <organization></organization>
          </author>

          <author fullname="Fei Feng" initials="F." surname="Fei Feng">
            <organization></organization>
          </author>

          <author fullname="Lingbo Tang" initials="L." surname="Tang">
            <organization></organization>
          </author>

          <author fullname="Zheng Cao" initials="Z." surname="Cao">
            <organization></organization>
          </author>

          <author fullname="Ming Zhang" initials="M." surname="Zhang">
            <organization></organization>
          </author>

          <author fullname="Frank Kelly" initials="F." surname="Kelly">
            <organization></organization>
          </author>

          <author fullname="Mohammad Alizadeh" initials="M." surname="Alizadeh">
            <organization></organization>
          </author>

          <author fullname="Minlan Yu" initials="M." surname="Yu">
            <organization></organization>
          </author>

          <date month="August" year="2019" />
        </front>

        <seriesInfo name="ACM SIGCOMM"
		    value = "Beijing, China"/>

      </reference>


    

     </references>
  </back>
</rfc>
